/* 
   -------------------------------------------------------------------------
   [CSS CLASS 1] Variables / 变量
   We define colors and fonts here once, so we can reuse them everywhere.
   If you want to change the theme to "Light Mode", you only need to change colors here!
   我们在这里定义颜色和字体，这样就可以在任何地方重复使用它们。
   如果你想把主题改成“亮色模式”，只需要在这里修改颜色即可！
   -------------------------------------------------------------------------
*/
:root {
    --bg-color: #0d0d12;
    --sidebar-bg: #16161e;
    --glass-bg: rgba(30, 30, 40, 0.6);
    --glass-border: rgba(255, 255, 255, 0.08);
    /* Semi-transparent white / 半透明白色 */
    --primary-color: #7c5cff;
    --primary-hover: #6b4bdb;
    --text-main: #e0e0e0;
    --text-dim: #a0a0b0;
    --success: #3dd68c;
    --warning: #eebb4d;
    --error: #ff5c5c;

    --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --font-mono: "Cascadia Code", "Fira Code", Consolas, "Courier New", monospace;
}

/* 
   [CSS CLASS 2] Reset / 重置
   Every browser adds its own default margins (white space). We remove them all here to start fresh.
   'box-sizing: border-box' makes sizing elements much easier (padding doesn't add to width).
   每个浏览器都会添加默认的边距。我们在这里把它们全部去掉，从零开始。
   'box-sizing: border-box' 让调整元素大小更容易（内边距不会增加元素的宽度）。
*/
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background-color: var(--bg-color);
    /* Use variable / 使用变量 */
    color: var(--text-main);
    font-family: var(--font-sans);
    height: 100vh;
    /* 100% Viewport Height (Full Screen) / 100% 视口高度（全屏） */
    overflow: hidden;
    /* Prevent scrolling the whole page / 防止整个页面滚动 */
}

/* 
   [CSS CLASS 3] Flexbox Layout / Flexbox 布局
   This container holds Sidebar + Chat Area side-by-side.
   这个容器把“侧边栏”和“聊天区”左右并排。
*/
.app-container {
    display: flex;
    /* Magic command for layout / 布局的魔法命令 */
    height: 100%;
}

/* Sidebar */
/* Sidebar / 侧边栏 */
.sidebar {
    width: 260px;
    /* Fixed width / 固定宽度 */
    background-color: var(--sidebar-bg);
    border-right: 1px solid var(--glass-border);
    display: flex;
    flex-direction: column;
    /* Stack items vertically top-to-bottom / 让内容从上往下垂直排列 */
    padding: 20px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    font-size: 1.2rem;
    margin-bottom: 40px;
    color: var(--primary-color);
}

.logo-icon {
    width: 32px;
    height: 32px;
    /* Gradient color / 渐变色 */
    background: linear-gradient(135deg, var(--primary-color), #a28aff);
    border-radius: 8px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
}

/* Session List Item */
.session-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    margin-bottom: 4px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--text-dim);
    transition: all 0.2s;
    text-decoration: none;
    position: relative;
    /* For absolute positioning of menu */
}

.session-item:hover,
.session-item.active {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-main);
}

.session-title {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.session-menu-trigger {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    color: var(--text-dim);
    opacity: 0;
    /* Hidden by default */
    transition: opacity 0.2s;
}

.session-item:hover .session-menu-trigger {
    opacity: 1;
}

.session-menu-trigger:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-main);
}

/* Session Context Menu */
.session-context-menu {
    position: absolute;
    right: 0;
    top: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: none;
    width: 120px;
    overflow: hidden;
}

.context-menu-item {
    padding: 8px 12px;
    font-size: 0.85rem;
    color: var(--text-main);
    cursor: pointer;
}

.context-menu-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.context-menu-item.danger {
    color: var(--error);
}

.context-menu-item.danger:hover {
    background: rgba(255, 92, 92, 0.1);
}

/* User Profile Area */
.nav-links a {
    display: block;
    padding: 12px 16px;
    margin-bottom: 8px;
    color: var(--text-dim);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s;
}

.nav-links a:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-main);
}

.nav-links a.active {
    background: rgba(124, 92, 255, 0.15);
    color: var(--primary-color);
}

/* Chat Area */
/* Chat Area / 聊天主区域 */
.chat-area {
    flex: 1;
    /* Take up all REMAINING space / 占据剩下所有的空间 */
    display: flex;
    flex-direction: column;
    position: relative;
    /* Radial Gradient Background / 径向渐变背景 */
    background: radial-gradient(circle at 50% 10%, #1f1f2e 0%, var(--bg-color) 40%);
}

.chat-header {
    padding: 20px 40px;
    border-bottom: 1px solid var(--glass-border);
    display: flex;
    justify-content: space-between;
    /* Space out items: Title <---space---> Status / 两端对齐：标题 <---空格---> 状态 */
    align-items: center;
    background: rgba(13, 13, 18, 0.8);
    /* [CSS CLASS 4] Glassmorphism / 毛玻璃效果 */
    /* This blurs whatever is BEHIND this element / 模糊这层元素背后的东西 */
    backdrop-filter: blur(10px);
}

.chat-header h1 {
    font-size: 1.1rem;
    font-weight: 500;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--text-dim);
}

.status-indicator.online {
    background-color: var(--success);
    box-shadow: 0 0 8px rgba(61, 214, 140, 0.4);
}

/* Messages */
.messages {
    flex: 1;
    padding: 40px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 900px;
    margin: 0 auto;
    width: 100%;
}

/* Message Bubbles / 消息气泡 */
.message {
    display: flex;
    gap: 16px;
    animation: fadeIn 0.3s ease;
    /* Use the animation defined below / 使用下面定义的动画 */
}

.message.user {
    flex-direction: row-reverse;
}

.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--glass-border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
    border: 1px solid var(--glass-border);
}

.message.assistant .avatar {
    background: linear-gradient(135deg, #2c2c3a, #1a1a24);
    color: var(--primary-color);
    border: 1px solid rgba(124, 92, 255, 0.3);
}

.message.user .avatar {
    background: #333;
    color: #fff;
}

.message .content,
.message-body {
    background: var(--glass-bg);
    padding: 16px 20px;
    border-radius: 12px;
    border: 1px solid var(--glass-border);
    line-height: 1.6;
    max-width: 80%;
    font-size: 0.95rem;
}

.message.user .content {
    background: rgba(124, 92, 255, 0.15);
    border-color: rgba(124, 92, 255, 0.3);
}

.message-body {
    display: flex;
    flex-direction: column;
    gap: 12px;
    background: transparent;
    border: none;
    padding: 0;
    width: 100%;
    max-width: 100%;
}

/* Thinking Block */
.thinking-block {
    background: rgba(255, 184, 108, 0.05);
    border: 1px solid rgba(255, 184, 108, 0.2);
    border-radius: 8px;
    overflow: hidden;
    font-size: 0.9rem;
}

.thinking-header {
    background: rgba(255, 184, 108, 0.1);
    padding: 8px 12px;
    color: #ffb86c;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    user-select: none;
}

.thinking-header .toggle-icon {
    margin-left: auto;
    font-size: 0.8rem;
    transition: transform 0.2s;
}

.thinking-block.collapsed .thinking-header .toggle-icon {
    transform: rotate(-90deg);
}

.thinking-content {
    padding: 12px;
    color: #dcdccc;
    font-family: var(--font-mono);
    white-space: pre-wrap;
    border-top: 1px solid rgba(255, 184, 108, 0.1);
    max-height: 300px;
    overflow-y: auto;
}

.thinking-block.collapsed .thinking-content {
    display: none;
}

/* Tool Block */
.tool-block {
    background: rgba(61, 214, 140, 0.05);
    border: 1px solid rgba(61, 214, 140, 0.2);
    border-radius: 8px;
    font-size: 0.85rem;
}

.tool-header {
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--success);
    background: rgba(61, 214, 140, 0.1);
    border-radius: 7px 7px 0 0;
}

.tool-name {
    font-weight: 600;
    font-family: var(--font-mono);
}

.tool-details {
    padding: 12px;
    background: rgba(0, 0, 0, 0.2);
    font-family: var(--font-mono);
}

.tool-args {
    color: #a0a0b0;
    margin-bottom: 8px;
    word-break: break-all;
}

.tool-output {
    color: #fff;
    border-top: 1px solid var(--glass-border);
    padding-top: 8px;
    margin-top: 8px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
}

.text-content {
    white-space: pre-wrap;
}

/* Input Area */
.input-area {
    padding: 20px 40px;
    background: transparent;
    display: flex;
    justify-content: center;
    padding-bottom: 40px;
}

.input-glass-container {
    width: 100%;
    max-width: 900px;
    background: rgba(30, 30, 40, 0.8);
    backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 10px;
    display: flex;
    gap: 10px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    transition: border-color 0.2s;
}

.input-glass-container:focus-within {
    border-color: var(--primary-color);
}

textarea {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text-main);
    font-family: var(--font-sans);
    font-size: 1rem;
    resize: none;
    padding: 12px;
    outline: none;
    max-height: 150px;
}

textarea::placeholder {
    color: var(--text-dim);
}

button {
    background: var(--primary-color);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}

button:hover {
    background: var(--primary-hover);
}

button:disabled {
    background: #444;
    cursor: not-allowed;
}

/* Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #444;
}

/* 
   [CSS CLASS 5] Keyframe Animations / 关键帧动画
   We can make things verify smooth. "fadeIn" means: start invisible and move up, then become visible and settle.
   我们可以制作流畅的动效。“fadeIn”的意思是：开始时透明且位置靠下，然后逐渐显现并向上浮动到位。
*/
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
        /* Start 10px lower / 从下方 10px 处开始 */
    }

    to {
        opacity: 1;
        /* Fully visible / 完全不透明 */
        transform: translateY(0);
        /* Final position / 最终位置 */
    }
}

/* Timeline / Execution Steps */
.execution-step {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    animation: fadeIn 0.3s ease;
}

.step-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    min-width: 24px;
}

.step-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(124, 92, 255, 0.2);
    border: 1px solid rgba(124, 92, 255, 0.4);
    color: var(--primary-color);
    font-size: 11px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
}

.step-line {
    flex: 1;
    width: 2px;
    background: rgba(255, 255, 255, 0.05);
    min-height: 20px;
    border-radius: 1px;
}

.step-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding-bottom: 20px;
    min-width: 0;
    /* Prevent overflow */
}

/* Update Thinking and Tool blocks to fit in timeline */
.thinking-block,
.tool-block,
.text-content {
    margin-left: 0;
    width: 100%;
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: var(--sidebar-bg);
    border: 1px solid var(--glass-border);
    padding: 30px;
    border-radius: 16px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s ease;
}

.modal-content h2 {
    margin-bottom: 20px;
    color: var(--text-main);
    text-align: center;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-dim);
    font-size: 0.9rem;
}

.form-group input {
    width: 100%;
    padding: 12px;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    color: var(--text-main);
    font-size: 1rem;
    outline: none;
}

.form-group input:focus {
    border-color: var(--primary-color);
}

.primary-btn {
    width: 100%;
    background: var(--primary-color);
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}

.primary-btn:hover {
    background: var(--primary-hover);
}

/* 1. 确保交互块能够撑满可用宽度，不被 Flex 压缩 */
.interaction-block {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-content: stretch;
}

/* 2. 核心修复：确保按钮在垂直布局中不收缩 */
.interaction-block button {
    background: rgba(255, 255, 255, 0.1);
    width: 100% !important;
    /* 强制按钮占满一行 */
    height: auto !important;
    /* 撤销可能的固定高度 */
    min-height: 44px;
    padding: 12px 16px !important;
    display: block;
    /* 确保是块级显示 */
    text-align: left;
    white-space: normal;
    /* 允许长文本换行 */
    word-wrap: break-word;
    flex-shrink: 0;
    /* 防止在 Flex 容器中被压缩 */
}

/* 3. 修复 markdown-body 在按钮内的干扰 */
.interaction-block .markdown-body p {
    margin: 0;
    width: 100%;
}

/* User Profile Area */
.user-profile-area {
    margin-top: auto;
    /* Push to bottom */
    padding-top: 20px;
    border-top: 1px solid var(--glass-border);
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    cursor: pointer;
    padding: 12px;
    border-radius: 12px;
    transition: background 0.2s;
}

.user-profile-area:hover {
    background: rgba(255, 255, 255, 0.05);
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #7c5cff, #a28aff);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    box-shadow: 0 4px 12px rgba(124, 92, 255, 0.3);
}

.user-info {
    flex: 1;
}

.user-name {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-main);
}

.user-status {
    font-size: 0.75rem;
    color: var(--success);
}

/* User Dropdown */
.user-dropdown {
    position: absolute;
    bottom: 100%;
    /* Show above profile area */
    left: 0;
    width: 100%;
    background: var(--sidebar-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 8px;
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
    display: none;
    /* Hidden by default */
    flex-direction: column;
    margin-bottom: 10px;
    animation: fadeIn 0.2s ease;
    z-index: 100;
}

/* Invisible bridge to prevent menu from closing when moving mouse across the gap */
.user-dropdown::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: 20px;
    /* Covers the 10px margin + buffer */
    background: transparent;
}

.user-profile-area:hover .user-dropdown,
.user-dropdown:hover {
    display: flex;
}

.dropdown-item {
    padding: 10px 12px;
    color: var(--text-dim);
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.dropdown-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-main);
}

.dropdown-divider {
    height: 1px;
    background: var(--glass-border);
    margin: 4px 0;
}

.dropdown-item.danger {
    color: var(--error);
}

.dropdown-item.danger:hover {
    background: rgba(255, 92, 92, 0.1);
}