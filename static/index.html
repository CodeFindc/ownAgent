<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic AI Interface</title>
    <!-- Fonts replaced by system fonts for offline usage -->
    <link rel="stylesheet" href="/static/style.css?v=5">
    <script src="/static/i18n.js"></script>
    <!-- Marked and Highlight.js for Markdown rendering -->
</head>
<script>
    window.onerror = function (msg, url, line, col, error) {
        alert("Global Error: " + msg + "\nURL: " + url + "\nLine: " + line);
        // Remove loader just in case so they can see something (or nothing)
        const loader = document.getElementById('app-loading');
        if (loader) loader.style.display = 'none';
        return false;
    };
</script>

<body>
    <div id="app-loading"
        style="position:fixed;top:0;left:0;width:100%;height:100%;background:#0d0d12;color:white;z-index:9999;display:flex;justify-content:center;align-items:center;font-family:sans-serif;font-size:24px;">
        Loading Application...
    </div>
    <div class="app-container">
        <!-- Sidebar (Optional, placeholder for future) -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">AG</div>
                <span>OwnAgent</span>
            </div>
            <nav class="nav-links">
                <a href="/" class="active" id="navMessages" data-i18n="nav_messages">Messages</a>
                <a href="/static/admin_users.html" id="navUsers" style="display:none;" data-i18n="nav_users">Users</a>
                <a href="/static/admin_settings.html" id="navSettings" style="display:none;"
                    data-i18n="nav_settings">Settings</a>
            </nav>

            <div class="session-header">
                <span data-i18n="history">HISTORY</span>
                <button class="new-chat-btn" id="newChatBtn" data-i18n="new_chat">New Chat</button>
            </div>
            <div class="session-list" id="sessionList">
                <!-- Sessions will be loaded here -->
            </div>


            <!-- User Profile (Bottom of Sidebar) -->
            <div id="userProfile" class="user-profile-area" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userNameDisplay">User</div>
                    <div class="user-status">Online</div>
                </div>

                <!-- Dropdown Menu -->
                <div class="user-dropdown" id="userDropdown">
                    <a href="/static/profile.html" class="dropdown-item" data-i18n="user_profile">My Profile</a>
                    <a href="/static/admin_users.html" class="dropdown-item" id="navAdminUsers" style="display:none;"
                        data-i18n="user_management">User Management</a>
                    <a href="/static/admin_settings.html" class="dropdown-item" id="navAdminSettings"
                        style="display:none;" data-i18n="platform_settings">Platform Settings</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" id="logoutBtn" class="dropdown-item danger" data-i18n="logout">Logout</a>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
            <header class="chat-header">
                <h1 data-i18n="chat_header">Agent Session</h1>
                <div class="status-indicator online"></div>
            </header>

            <div id="messages" class="messages">
                <!-- Initial System Message -->
                <div class="message system">
                    <div class="avatar">AG</div>
                    <div class="content">
                        Hello! I am your Agent.
                    </div>
                </div>
            </div>

            <div class="input-area">
                <textarea id="userInput" placeholder="Type your message..." rows="1"
                    data-i18n-placeholder="type_message"></textarea>
                <button id="sendBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </main>
    </div>

    <!-- Templates for JS to clone -->
    <template id="msg-template-user">
        <div class="message user">
            <div class="content"></div>
            <div class="avatar">You</div>
        </div>
    </template>

    <template id="msg-template-assistant">
        <div class="message assistant">
            <div class="avatar">AG</div>
            <div class="message-body">
                <!-- Components will be appended here (Thinking, Tools, Content) -->
            </div>
        </div>
    </template>

    <template id="thinking-template">
        <div class="thinking-block">
            <div class="thinking-header">
                <span class="icon">✨</span> Thinking Process
                <span class="toggle-icon">▼</span>
            </div>
            <div class="thinking-content markdown-body"></div>
        </div>
    </template>

    <template id="tool-call-template">
        <div class="tool-block">
            <div class="tool-header">
                <span class="icon">⚙️</span>
                <span class="tool-name">Tool Name</span>
                <span class="status">Running...</span>
            </div>
            <div class="tool-details">
                <div class="tool-args"></div>
                <div class="tool-output hidden"></div>
            </div>
        </div>
    </template>

    <!-- 
        [English] Import the Marked library from the libs folder.
        This gives us access to the 'marked.parse()' function in our JavaScript.
        [中文说明] 从 libs 文件夹引入 Marked 库。
        这让我们可以在 JavaScript 中使用 'marked.parse()' 函数。
    -->
    <script src="/static/libs/marked.min.js"></script>
    <script src="/static/app.js?v=4"></script>
</body>

</html>